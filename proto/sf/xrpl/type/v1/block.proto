syntax = "proto3";
package sf.xrpl.type.v1;

option go_package = "github.com/xrpl-commons/firehose-xrpl/pb/sf/xrpl/type/v1;pbxrpl";

import "google/protobuf/timestamp.proto";

// Transaction type imports
import "sf/xrpl/type/v1/payment.proto";
import "sf/xrpl/type/v1/offer.proto";
import "sf/xrpl/type/v1/trustline.proto";
import "sf/xrpl/type/v1/account.proto";
import "sf/xrpl/type/v1/escrow.proto";
import "sf/xrpl/type/v1/nft.proto";
import "sf/xrpl/type/v1/payment_channel.proto";
import "sf/xrpl/type/v1/check.proto";
import "sf/xrpl/type/v1/deposit_preauth.proto";
import "sf/xrpl/type/v1/ticket.proto";
import "sf/xrpl/type/v1/clawback.proto";
import "sf/xrpl/type/v1/amm.proto";
import "sf/xrpl/type/v1/xchain.proto";
import "sf/xrpl/type/v1/did.proto";
import "sf/xrpl/type/v1/oracle.proto";
import "sf/xrpl/type/v1/mptoken.proto";
import "sf/xrpl/type/v1/credential.proto";
import "sf/xrpl/type/v1/permissioned_domain.proto";
import "sf/xrpl/type/v1/vault.proto";
import "sf/xrpl/type/v1/delegate.proto";
import "sf/xrpl/type/v1/contract.proto";
import "sf/xrpl/type/v1/system.proto";

// Block represents an XRPL validated ledger
message Block {
  // Ledger sequence number (ledger_index)
  uint64 number = 1;

  // Ledger hash (32 bytes)
  bytes hash = 2;

  // Ledger header information
  Header header = 3;

  // Schema version for this protobuf
  int64 version = 4;

  // Transactions in this ledger
  repeated Transaction transactions = 5;

  // Ledger close time
  google.protobuf.Timestamp close_time = 6;
}

message Header {
  // Parent ledger hash
  bytes parent_hash = 1;

  // Total XRP in drops (int64 for 10^17 max)
  int64 total_drops = 2;

  // Account state hash (state tree root)
  bytes account_hash = 3;

  // Transaction tree hash
  bytes transaction_hash = 4;

  // Close time resolution in seconds
  uint32 close_time_resolution = 5;

  // Close flags
  uint32 close_flags = 6;
}

message Transaction {
  // Transaction hash (32 bytes)
  bytes hash = 1;

  // Transaction result
  TransactionResult result = 2;

  // Position in ledger (0-indexed)
  uint32 index = 3;

  // Raw transaction blob (XRPL binary format)
  // Kept for backward compatibility and advanced decoding
  bytes tx_blob = 4;

  // Transaction metadata blob (XRPL binary format)
  // Contains: AffectedNodes, delivered_amount, etc.
  bytes meta_blob = 5;

  // Transaction type for filtering
  TransactionType tx_type = 6;

  // Account that initiated this transaction
  string account = 7;

  // Fee paid in drops
  uint64 fee = 8;

  // Transaction sequence number
  uint32 sequence = 9;

  // Decoded transaction details based on tx_type
  oneof tx_details {
    // Payment transactions
    Payment payment = 20;

    // DEX transactions
    OfferCreate offer_create = 21;
    OfferCancel offer_cancel = 22;

    // Trustline
    TrustSet trust_set = 23;

    // Account management
    AccountSet account_set = 24;
    AccountDelete account_delete = 25;
    SetRegularKey set_regular_key = 26;
    SignerListSet signer_list_set = 27;

    // Escrow
    EscrowCreate escrow_create = 30;
    EscrowFinish escrow_finish = 31;
    EscrowCancel escrow_cancel = 32;

    // Payment channels
    PaymentChannelCreate payment_channel_create = 33;
    PaymentChannelFund payment_channel_fund = 34;
    PaymentChannelClaim payment_channel_claim = 35;

    // Checks
    CheckCreate check_create = 36;
    CheckCash check_cash = 37;
    CheckCancel check_cancel = 38;

    // Other account features
    DepositPreauth deposit_preauth = 39;
    TicketCreate ticket_create = 40;

    // NFT transactions
    NFTokenMint nftoken_mint = 50;
    NFTokenBurn nftoken_burn = 51;
    NFTokenCreateOffer nftoken_create_offer = 52;
    NFTokenCancelOffer nftoken_cancel_offer = 53;
    NFTokenAcceptOffer nftoken_accept_offer = 54;

    // Clawback
    Clawback clawback = 60;

    // AMM transactions
    AMMCreate amm_create = 70;
    AMMDeposit amm_deposit = 71;
    AMMWithdraw amm_withdraw = 72;
    AMMVote amm_vote = 73;
    AMMBid amm_bid = 74;
    AMMDelete amm_delete = 75;
    AMMClawback amm_clawback = 76;

    // Cross-chain bridge transactions
    XChainCreateBridge xchain_create_bridge = 80;
    XChainModifyBridge xchain_modify_bridge = 81;
    XChainCreateClaimID xchain_create_claim_id = 82;
    XChainCommit xchain_commit = 83;
    XChainClaim xchain_claim = 84;
    XChainAccountCreateCommit xchain_account_create_commit = 85;
    XChainAddClaimAttestation xchain_add_claim_attestation = 86;
    XChainAddAccountCreateAttestation xchain_add_account_create_attestation =
        87;

    // DID transactions
    DIDSet did_set = 90;
    DIDDelete did_delete = 91;

    // Oracle transactions
    OracleSet oracle_set = 92;
    OracleDelete oracle_delete = 93;

    // MPToken transactions
    MPTokenIssuanceCreate mptoken_issuance_create = 100;
    MPTokenIssuanceDestroy mptoken_issuance_destroy = 101;
    MPTokenIssuanceSet mptoken_issuance_set = 102;
    MPTokenAuthorize mptoken_authorize = 103;

    // Credential transactions
    CredentialCreate credential_create = 110;
    CredentialAccept credential_accept = 111;
    CredentialDelete credential_delete = 112;

    // Permissioned domain transactions
    PermissionedDomainSet permissioned_domain_set = 120;
    PermissionedDomainDelete permissioned_domain_delete = 121;

    // Delegate transactions
    DelegateSet delegate_set = 122;

    // Vault transactions
    VaultCreate vault_create = 130;
    VaultSet vault_set = 131;
    VaultDelete vault_delete = 132;
    VaultDeposit vault_deposit = 133;
    VaultWithdraw vault_withdraw = 134;
    VaultClawback vault_clawback = 135;

    // Smart contract transactions
    ContractCreate contract_create = 140;
    ContractModify contract_modify = 141;
    ContractDelete contract_delete = 142;
    ContractClawback contract_clawback = 143;
    ContractUserDelete contract_user_delete = 144;
    ContractCall contract_call = 145;

    // System transactions (pseudo-transactions)
    EnableAmendment enable_amendment = 200;
    SetFee set_fee = 201;
    UNLModify unl_modify = 202;
    LedgerStateFix ledger_state_fix = 203;
  }
}

// Transaction result code
enum TransactionResult {
  RESULT_UNKNOWN = 0;
  TES_SUCCESS = 1;                // tesSUCCESS - fully applied
  TEC_CLAIMED = 2;                // tecCLAIMED - fee claimed, tx failed
  TEC_PATH_PARTIAL = 3;           // tecPATH_PARTIAL
  TEC_UNFUNDED_ADD = 4;           // tecUNFUNDED_ADD
  TEC_UNFUNDED_OFFER = 5;         // tecUNFUNDED_OFFER
  TEC_UNFUNDED_PAYMENT = 6;       // tecUNFUNDED_PAYMENT
  TEC_FAILED_PROCESSING = 7;      // tecFAILED_PROCESSING
  TEC_DIR_FULL = 8;               // tecDIR_FULL
  TEC_INSUF_RESERVE_LINE = 9;     // tecINSUF_RESERVE_LINE
  TEC_INSUF_RESERVE_OFFER = 10;   // tecINSUF_RESERVE_OFFER
  TEC_NO_DST = 11;                // tecNO_DST
  TEC_NO_DST_INSUF_XRP = 12;      // tecNO_DST_INSUF_XRP
  TEC_NO_LINE_INSUF_RESERVE = 13; // tecNO_LINE_INSUF_RESERVE
  TEC_NO_LINE_REDUNDANT = 14;     // tecNO_LINE_REDUNDANT
  TEC_PATH_DRY = 15;              // tecPATH_DRY
  TEC_UNFUNDED = 16;              // tecUNFUNDED
  TEC_NO_ALTERNATIVE_KEY = 17;    // tecNO_ALTERNATIVE_KEY
  TEC_NO_REGULAR_KEY = 18;        // tecNO_REGULAR_KEY
  TEC_OTHER = 100;                // Other tec* codes
  TEF_FAILURE = 200;              // tef* - local failure
  TEM_MALFORMED = 300;            // tem* - malformed
  TER_RETRY = 400;                // ter* - retry
}

// Common XRPL transaction types for filtering
enum TransactionType {
  TX_UNKNOWN = 0;
  TX_PAYMENT = 1;
  TX_ESCROW_CREATE = 2;
  TX_ESCROW_FINISH = 3;
  TX_ACCOUNT_SET = 4;
  TX_ESCROW_CANCEL = 5;
  TX_SET_REGULAR_KEY = 6;
  TX_NICKNAME_SET = 7; // Deprecated
  TX_OFFER_CREATE = 8;
  TX_OFFER_CANCEL = 9;
  TX_CONTRACT = 10; // Deprecated
  TX_TICKET_CREATE = 11;
  TX_TICKET_CANCEL = 12; // Deprecated
  TX_SIGNER_LIST_SET = 13;
  TX_PAYMENT_CHANNEL_CREATE = 14;
  TX_PAYMENT_CHANNEL_FUND = 15;
  TX_PAYMENT_CHANNEL_CLAIM = 16;
  TX_CHECK_CREATE = 17;
  TX_CHECK_CASH = 18;
  TX_CHECK_CANCEL = 19;
  TX_DEPOSIT_PREAUTH = 20;
  TX_TRUST_SET = 21;
  TX_ACCOUNT_DELETE = 22;
  TX_SET_HOOK = 23;
  TX_NFT_MINT = 25;
  TX_NFT_BURN = 26;
  TX_NFT_CREATE_OFFER = 27;
  TX_NFT_CANCEL_OFFER = 28;
  TX_NFT_ACCEPT_OFFER = 29;
  TX_CLAWBACK = 30;
  TX_AMM_CLAWBACK = 31;
  TX_AMM_CREATE = 35;
  TX_AMM_DEPOSIT = 36;
  TX_AMM_WITHDRAW = 37;
  TX_AMM_VOTE = 38;
  TX_AMM_BID = 39;
  TX_AMM_DELETE = 40;
  TX_XCHAIN_CREATE_CLAIM_ID = 41;
  TX_XCHAIN_COMMIT = 42;
  TX_XCHAIN_CLAIM = 43;
  TX_XCHAIN_ACCOUNT_CREATE_COMMIT = 44;
  TX_XCHAIN_ADD_CLAIM_ATTESTATION = 45;
  TX_XCHAIN_ADD_ACCOUNT_CREATE_ATTESTATION = 46;
  TX_XCHAIN_MODIFY_BRIDGE = 47;
  TX_XCHAIN_CREATE_BRIDGE = 48;
  TX_DID_SET = 49;
  TX_DID_DELETE = 50;
  TX_ORACLE_SET = 51;
  TX_ORACLE_DELETE = 52;
  TX_LEDGER_STATE_FIX = 53;
  TX_MPTOKEN_ISSUANCE_CREATE = 54;
  TX_MPTOKEN_ISSUANCE_DESTROY = 55;
  TX_MPTOKEN_ISSUANCE_SET = 56;
  TX_MPTOKEN_AUTHORIZE = 57;
  TX_CREDENTIAL_CREATE = 58;
  TX_CREDENTIAL_ACCEPT = 59;
  TX_CREDENTIAL_DELETE = 60;
  TX_NFTOKEN_MODIFY = 61;
  TX_PERMISSIONED_DOMAIN_SET = 62;
  TX_PERMISSIONED_DOMAIN_DELETE = 63;
  TX_DELEGATE_SET = 64;
  TX_VAULT_CREATE = 65;
  TX_VAULT_SET = 66;
  TX_VAULT_DELETE = 67;
  TX_VAULT_DEPOSIT = 68;
  TX_VAULT_WITHDRAW = 69;
  TX_VAULT_CLAWBACK = 70;
  TX_BATCH = 71;
  TX_CONTRACT_CREATE = 72;
  TX_CONTRACT_MODIFY = 73;
  TX_CONTRACT_DELETE = 74;
  TX_CONTRACT_CLAWBACK = 75;
  TX_CONTRACT_USER_DELETE = 76;
  TX_CONTRACT_CALL = 77;
  // System/pseudo-transactions
  TX_ENABLE_AMENDMENT = 100;
  TX_SET_FEE = 101;
  TX_UNL_MODIFY = 102;
}
